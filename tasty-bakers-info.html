<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="./styles/home.css">

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pouchdb/7.2.2/pouchdb.min.js"
        integrity="sha512-2Uc5uGzoGNFBmgURVIs1QZagEEt0rgJrSEcAXwP6c5EA6xGEyTQ1iViZO+CAR804xTHiAMIKFq+rxlJpurDZfQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <title>Home Gourmet</title>
</head>

<body>
    <div data-role="page" id="Home">
        <div id="hg-header" data-role="header" data-position="fixed">
            <div class="hg-logo-div">
                <a id="hg-icon-btn-back" href="./tasty-bakers.html" target="_self" data-transition="slide"
                    data-direction="reverse"><i data-feather="chevron-left"></i></a>
                <a class="hg-button" id="logo-btn" href="index.html" target="_self" class="ui-btn"><img
                        src="./images/Logo.png" height="62.56px"></a>
            </div>
            <div class="hg-header-icon-div">
                <a href="#Page2" class="ui-btn" id="hg-icon-btn"><i data-feather="user"></i></a>
                <a href="#Page2" class="ui-btn" id="hg-icon-btn"><i data-feather="shopping-cart"></i></a>
                <a href="#Menu" data-transition="slide" class="ui-btn" id="hg-icon-btn-right"><i
                        data-feather="menu"></i></a>
            </div>
        </div>
        <img class="hg-order-banner" src="./images/hg-view-order-2.jpg">

        <div role="main" id="hg-main">

            <h2 class="hg-main-heading" id="info-page-heading">Tasty Bakers</h2>
            <div class="hg-main-sub-text">At tasty bakers we provide the most delicious home-made baked goods money
                can buy. Our specialties are our french pastries. Order from us to try the best pastries in colombo.
            </div>

            <div class="hg-info-content">
                <h2 class="hg-secondary-heading" id="hg-info-rating-heading">Rating</h2>
                <div class="hg-info-rating">
                    <i class="hg-info-rating-icon filled" data-feather="star"></i>
                    <i class="hg-info-rating-icon filled" data-feather="star"></i>
                    <i class="hg-info-rating-icon filled" data-feather="star"></i>
                    <i class="hg-info-rating-icon filled" data-feather="star"></i>
                    <i class="hg-info-rating-icon" data-feather="star"></i>
                    <div id="hg-info-rating-text" class="hg-main-sub-text">4.0</div>
                </div>
                <h2 class="hg-secondary-heading" id="hg-info-contact-heading">Contact No</h2>
                <div id="hg-info-contact" class="hg-main-sub-text">+94 77928372</div>
            </div>
            <div class="hg-info-content">
                <h2 class="hg-secondary-heading">Address</h2>
                <div class="hg-main-sub-text">5, Ramakirshna Rd, Colombo 06</div>
                <img src="./images/hg-info-map.png" id="info-map-img">
            </div>
            <h2 class="hg-secondary-heading">Comments <p class="hg-main-sub-text" id="no-of-comments"
                    style="padding-left:0;"></p>
            </h2>

            <div id="tasty-bakers-view-comments">
                <div class="hg-main-sub-text">No comments currently available</div>
            </div>

        </div>

        <!--Footer-->
        <div id="hg-footer" data-role="footer">

            <div class="container">
                <div class="nav-wrapper">
                    <nav class="nav">
                        <ul class="nav-list ul-reset">
                            <li class="nav-item">
                                <div class="nav-item-inner">
                                    <a href="#" class="nav-item-inner-heading plus">
                                        <p id="hg-footer-heading">About</p>
                                    </a>
                                    </a>
                                    <ul class="nav-sub-list ul-reset">
                                        <div class="nav-sub-list-inner">
                                            <li class="nav-sub-item">
                                                <p>Founded in 2020, Home Gourmet is the most widely used
                                                    home-cooked
                                                    food delivery app in Sri
                                                    Lanka
                                                    today. <u>Read more</u></p>
                                            </li>
                                        </div>
                                    </ul>
                                </div>
                            </li>
                            <li class="nav-item">
                                <div class="nav-item-inner">
                                    <a href="#" class="nav-item-inner-heading plus">
                                        <p id="hg-footer-heading">Contact</p>
                                    </a>
                                    <ul class="nav-sub-list ul-reset">
                                        <div class="nav-sub-list-inner">
                                            <li class="nav-sub-item">
                                                <p>Email : homegourmet@gmail.com</p>
                                                <p>Mobile : (+94) 77 899 3645</p>
                                            </li>
                                        </div>
                                    </ul>
                                </div>
                            </li>
                            <li class="nav-item">
                                <div class="nav-item-inner">
                                    <a href="#" class="nav-item-inner-heading plus">
                                        <p id="hg-footer-heading">Follow Us</p>
                                    </a>
                                    <ul class="nav-sub-list ul-reset">
                                        <div class="nav-sub-list-inner">
                                            <li class="nav-sub-item">
                                                <p>Instagram </p>
                                                <p>Facebook </p>
                                                <p>Pinterest </p>
                                            </li>
                                        </div>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>


            <div id="hg-footer-links-div">
                <a id="hg-footer-links">Terms and Conditions</a> . <a id="hg-footer-links">Privacy Statement</a>
            </div>
        </div>

    </div>











    <!-- First menu-->
    <div data-role="page" id="Menu">

        <div data-role="header" id="hg-header">
            <div class="hg-menu-logo-div">
                <a class="hg-button" id="logo-btn" href="index.html" target="_self" class="ui-btn"><img
                        src="./images/Logo.png" height="62.56px"></a>
                <a id="hg-icon-btn-right-close" href="#Home" data-transition="slide" class="ui-btn"
                    data-direction="reverse"><i data-feather="x"></i></a>

            </div>

        </div>

        <div role="main" class="ui-content" id="hg-menu" data-transition="slide">

            <div data-role="controlgroup" data-type="vertical">
                <a href="#Menu2" data-transition="slide" id="hg-menu-btn">Categories
                    <i id="hg-icon-chevron" data-feather="chevron-right"></i></a>
                <a href="#" id="hg-menu-btn">Promotions</a>
                <a href="#" id="hg-menu-btn">Rewards Center</a>
                <a href="./orders.html" target="_self" id="hg-menu-btn">Orders</a>
                <a href="#" id="hg-menu-btn">Favorites</a>
                <a href="./qr-scanner.html" target="_self" id="hg-menu-btn">QR Scanner</a>
                <a href="#" id="hg-menu-btn">About Us</a>
                <a href="#" id="hg-menu-btn">Sign In</a>
            </div>
        </div>


    </div>
    <!-- Second menu-->

    <div data-role="page" id="Menu2">

        <div data-role="header" id="hg-header">
            <div id="hg-menu2-heading-div">
                <h2 id="hg-menu2-heading">Categories</h2>
                <a id="hg-icon-btn-right-close-menu2" href="#Menu" data-transition="slide" class="ui-btn"
                    data-direction="reverse"><i data-feather="chevron-left"></i></a>

            </div>

        </div>

        <div role="main" class="ui-content" id="hg-menu" data-transition="slide">

            <div data-role="controlgroup" data-type="vertical">
                <a href="#" id="hg-menu-btn">Chinese</a>
                <a href="bakery.html" target="_self" id="hg-menu-btn">Bakery</a>
                <a href="#" id="hg-menu-btn">Italian</a>
                <a href="#" id="hg-menu-btn">Burgers</a>
                <a href="#" id="hg-menu-btn">Desserts</a>
                <a href="#" id="hg-menu-btn">Drinks</a>
            </div>
        </div>


    </div>

    <!--Write Comment Dialog Box-->

    <div data-role="page" id="write-comment-dialog" data-dialog="true" data-close-btn="right">
        <div data-role="header" id="hg-dialog-header">
            <h2 class="hg-dialog-main-heading">Write comment</h2>
        </div>
        <div class="ui-content" role="main">
            <textarea id="hg-input-post-comment" type="text" placeholder="Write Comment Here"></textarea>
            <div class="hg-post-comment-btn">
                <a id="hg-post-comment-btn" class="ui-btn" href="#comment-added-dialog">Post Reply</a>
            </div>
        </div>
    </div>


    <!-- Comment Added Dialog Box-->

    <div data-role="page" id="comment-added-dialog" data-dialog="true" data-close-btn="none">

        <div data-role="header" id="hg-dialog-header">
            <img class="hg-dialog-main-img" src="./images/dialog-tick.png">
            <h2 class="hg-dialog-main-heading">Comment added!</h2>
        </div>
        <div class="ui-content" role="main">

            <div class="hg-dialog-text">Your comment has been added successfully. Thank you for sharing your
                experience.
            </div>

            <div class="hg-order-view-btn">
                <a id="hg-success-comment-btn" class="ui-btn" href="./tasty-bakers-info.html">Keep Browsing</a>
            </div>
        </div>
    </div>

</body>

<script>

    feather.replace()

    function accordion(section, heading, list) {
        $(section).each(function () {
            var act = 'active',
                actClass = '.active',
                that = $(this);

            function tglH() {
                that.find(list).slideToggle(250);
            }
            function open(click) {
                $(click).toggleClass('plus minus');
                tglH();
                that.find(list).addClass(act);
            }
            function close(click) {
                $(click).toggleClass('minus plus');
                tglH();
                that.find(list).removeClass(act);
            }

            if (that.find(list).length == 0) {
                $(this).find(heading).removeClass('plus').addClass('no-sub');
            } else {
                $(this).find(heading).click(function (e) {
                    e.preventDefault();
                });
            }

            $(this).find(heading).click(function () {
                if ($(this).hasClass('minus')) {
                    // close this menu
                    close(this);
                    that.find(list).removeClass(act);
                } else if ($(this).hasClass('plus')) {
                    if ($(heading).hasClass('minus')) {
                        $(heading).each(function () {
                            if (!$(this).hasClass('no-sub')) {
                                $(this).removeClass('minus').addClass('plus');
                            }
                        })
                        $(section).each(function () {
                            if ($(this).find(list).hasClass(act)) {
                                $(actClass).slideToggle(250);
                                $(this).find(list).removeClass(act);
                            }
                        });
                        // open this menu
                        open(this);
                    } else if ($(this).hasClass('plus')) {
                        // open this menu
                        open(this);
                    }
                }
            })
        })
    }
    accordion('.nav-item', '.nav-item-inner-heading', '.nav-sub-list');


</script>
<script>

    var db = new PouchDB('POI');

    var documentID = "Tasty Bakers";



    db.get(documentID).then(function (doc) {

        function initializeReplies(doc) {
            var comments = doc.comments;
            $("#no-of-comments").append(`(${comments.length} comments)`);
            if(comments.length > 0){
                  $("#tasty-bakers-view-comments").empty();
            }
            comments.forEach((line, index) => {
                console.log(line)
                $("#tasty-bakers-view-comments").append(`<div class="comment-writer"> ${line[0]} </div><div class="comment-holder-div"><div class="comment-text"> ${line[1]} </div><div class="float-right-div"><div class="comment-date"> ${timeDifference(new Date(), new Date(line[2]))} </div><div><a id="${index}" class="reply-btn" style="color:#00567B;font-size:small;" href="#write-comment-dialog">
                Reply
            </a></div></div></div>`);

                line[3].forEach((reply, index) => {
                    $("#tasty-bakers-view-comments").append(`<div class="comment-writer seller"> Seller </div><div class="comment-text seller"> ${reply} </div>`)
                });

            });
        }

        initializeReplies(doc)




        var replyID = "";

        $(document).on('click', '.reply-btn', function (event) {
            replyID = parseInt(event.target.id);
        });

        $("#comment-added-dialog").click(() => {

            var reply = $("#hg-input-post-comment").val();
            db.get("Tasty Bakers").then(function (doc) {

                var index = doc.comments[replyID][3].length;
                doc.comments[replyID][3][index] = reply;

                return db.put(doc);
            }).then(function () {
                return db.get("Tasty Bakers");
            }).then(function (doc) {
                $("#no-of-comments").empty();
                $("#tasty-bakers-view-comments").empty();
                initializeReplies(doc);
                console.log(doc);
            });



            $("#hg-input-post-comment").val("")

        });
    });

    function timeDifference(current, previous) {

        var msPerMinute = 60 * 1000;
        var msPerHour = msPerMinute * 60;
        var msPerDay = msPerHour * 24;
        var msPerMonth = msPerDay * 30;
        var msPerYear = msPerDay * 365;

        var elapsed = current - previous;

        if (elapsed < msPerMinute) {
            return Math.round(elapsed / 1000) + ' s';
        }

        else if (elapsed < msPerHour) {
            return Math.round(elapsed / msPerMinute) + ' s';
        }

        else if (elapsed < msPerDay) {
            return Math.round(elapsed / msPerHour) + ' h';
        }

        else if (elapsed < msPerMonth) {
            return 'approximately ' + Math.round(elapsed / msPerDay) + ' d';
        }

        else if (elapsed < msPerYear) {
            return 'approximately ' + Math.round(elapsed / msPerMonth) + ' m';
        }

        else {
            return 'approximately ' + Math.round(elapsed / msPerYear) + ' y';
        }
    }

</script>


</html>
